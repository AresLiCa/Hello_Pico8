pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- wall and actor collisions
-- by zep

actor = {} --all actors in world
player = {}
music(0)
-- make an actor
-- and add to global collection
-- x,y means center of the actor
-- in map tiles (not pixels)
function make_actor(x, y, _name)
 a={}
 a.name = _name
 a.x = x
 a.y = y
 a.dx = 0 --moving speed
 a.dy = 2 --moving speed
 a.spr = 33
 a.frame = 0
 --a.t = 0
 --a.inertia = 0.6
 --a.bounce  = 1
 a.frames=0

 
 -- half-width and half-height
 -- slightly less than 0.5 so
 -- that will fit through 1-wide
 -- holes.
 a.w = 8
 a.h = 8
 a.moving_speed = 1
 add(actor,a)
 
 return a
end

function _init()
 -- make player top left
 --pl = make_actor(2,2)
 player = make_actor(128/2, 80,"player")
 player.spr = 0
 player.dy = 0


end

function move_actor(a)

 -- only move actor along x
 -- if the resulting position
 -- will not overlap with a wall

 
  a.x += a.dx
  
 

 -- ditto for y

 
  a.y += a.dy
 
 

 
end

function control_player()
 the_player = get_player()
 if (btn(1)) then 
   the_player.x += 3
 end
 if (btn(0)) then 
   the_player.x -= 3
 end
end


function _update60()
 control_player()
 
 t = time()

    if t % 0.5 == 0 and rnd(1) < 0.5 then
        make_actor(rnd(118)+5,0,"seed")
       -- make_actor(128/2,0)
    end



 foreach(actor, move_actor)
 --only detect the seeds for removing instead of the player

 foreach(actor, remove_actor)
 


end

function remove_actor(a)
    

    if a.name~="player" then

        if a.y > 128 then
            del(actor, a)
        end

        if is_collide(a,get_player()) and get_player()~=nil then
          del(actor, a)
            
        end
    end
    



   
end

function get_player()
 -- find the player based on the object name
 for a in all(actor) do
    if a.name == "player" then
     return a
    end
 end

end


function is_collide(a, b)

    local hit = false
    
    

    if(a~=nil and b~=nil) then
        local xs = a.w*0.5+b.w*0.5
        local ys = a.h*0.5+b.h*0.5

        local xd = abs((a.x + 0.5*a.w) - (b.x + 0.5 * b.w))
        local yd = abs((a.y + 0.5*a.h) - (b.y + 0.5 * b.h))

        
        if xd<xs and yd<ys then
         hit = true        
        end
    end
    return hit
end

function draw_actor(a)

    if (a.name=="seed") then
      local sx = (a.x)
      local sy = (a.y)
      a.spr=46
      spr(a.spr, sx, sy)
    end

    if (a.name=="player") then
      --spr(0, get_player().x, get_player().y,2,2)
      a.spr=0
      a.w=16
      a.h=16
      spr(a.spr, get_player().x, get_player().y,2,2)
    end
end

function _draw()
 cls()

-- map(0,0,0,0,16,16)
    foreach(actor,draw_actor)
 
 if(actor~=nil) then
    print("actor numbers? "..#actor,0,120,7)
 end
 if(get_player~=nil) then
    print("player pos: x "..get_player().x.."  y "..get_player().y,0,110,7)

 end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000055500055500000005550005550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000059500059500000005950005950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000059955599500000005995559950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000559999999500000055999999950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000389999d77d950000389999d77d95000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0038339999d77d950038339999d77d95000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003999997777d775003999997777d775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05999997777777750599999777777775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
59999997777777755999999777777775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
59999999777777905999999977777790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
59999999977777905999999997777790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
59999999977777905999999997777790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
59955955975557905955995557555790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05550500555055505550550055005500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a000000a00500500050000505555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000aa00000000000
aaaaaaaa0660066066000066555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaa0000000000
0000000000aaaa000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000a000000000
000000000a0000a0070000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000770a00000000
00000000a000770a700077070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000770a00000000
00000000a000770a700077070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000a00000000
00000000a000000a700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000aa00000000
00000000a000000a7000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaa0000000000
000000000a0000a00700007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000a000000000
0000000000aaaa0000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaa0000000000
00000000008888000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000088888800888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000288888882888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000002e8e8e8e28e8e8e800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000002e8e8e8e28e8e8e800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000228888882288888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022888800228888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002222000022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0002020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000400000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000003000000000004020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0302020200000004000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200040000000000000100000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200020000040000000000000300020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000400000000000200020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000401000200030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0304000202020000000101000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000202020000000400000200020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000002020202020204020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000400000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0302020202030202020202020203020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
01100000005003200000000000000050000000000003200000500000003100000000005002a00000000000000050029000000002b0000050000000210002a000005002a000000000000000500000002900000000
011800000c043185201c5201f5203c6151f020210201c0200c04318020280202b0203c5351b0201a020180200c04324020280202b0203c6151f020210201c0200c04324020280202b0203c535332103222030220
011800002b552297422873224542245502404024531285412b552297422873224540245502404228532245422b552297422873224540245502404128531245422b55229742287322454024550240412652124522
011800000042504335072450c4550032504235074450c3550023504445073550c265321230c0002f0141b1110033504245074550c3650023504445073550c2650043504345072550c465331210c0002f0111b111
011800000c02510535130250c5351802510535130250c5350c0251c5351302527711177111c71120711197110c025105351f0250c5350c0251053513025185350c025105351302527711177111c7112071119711
0118000024325283252b325303262b3252d32528325263001c326283252b325303252722526225242252630024325283262b325303252b3252d326283252630024325282252b2263022533327324253021030215
011800001024513355184650c2351034513400182000c3001034513335243652674524544245441b100000001024513355184650c2351034513400182000c3001034513335243652674524544245441b10000000
0118000004125040350412504035041250403504125040351c1151c12534115281251c1151071110711107111c1151c125281151c1251c7211072110721107211c1151c125341152612528111281111c7111c711
011800001f5520042504335072450c4550032504235074450c3550023504445073550c265321230c0002f0141b1110033504245074550c3650023504445073550c2650043504345072550c465331210c0002f011
011800002400028552241422853226122000002b02226032000002b04600000297522874200000260320000024022000002803226042000002b7552674228000285322912226532290002900024547245551a000
0118000004125040320c0251c532130260c5321802510535130250c5330c0251c5351302400000000000000018025105351f0250c535180251053613025185351802510533130250e535180341c7000000000000
01180000303151c525373153c526373153952534115263002841534515373153c2173331532515302151851200000302153411637315355123431532515345150000000000325153431535115327143071400000
01180000280002b0422b0322b042000002b0422d0322d04228042280322b000290422903229041280422604226032000000000024042260422803228042000002604228032290472904229032260322403124031
0118000024115282152b115302162b1152d21528115263001c216281152b215301152721526115242152630018115282162b115302152b1152d216281152630024115282152b1163021527117264152441024415
__music__
00 01030405
00 01090405
00 01060705
00 01020705
00 01030405
00 01090a0b
02 010c0a0d
00 41434444

