pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- wall and actor collisions
-- by zep

actor = {} --all actors in world
player = {}
music(0)
player_walking_anim_time_gap = 0
scene = "start"
sprites_list = {32,33,48,49,50,51}
-- make an actor
-- and add to global collection
-- x,y means center of the actor
-- in map tiles (not pixels)
function make_actor(x, y, _name)
 a={}
 a.name = _name
 a.x = x
 a.y = y
 a.dx = 0 --moving speed
 a.dy = 2 --moving speed
 a.spr = 33
 a.frame = 0
 --a.t = 0
 --a.inertia = 0.6
 --a.bounce  = 1
 a.frames=0

 
 -- half-width and half-height
 -- slightly less than 0.5 so
 -- that will fit through 1-wide
 -- holes.
 a.w = 8
 a.h = 8
 a.moving_speed = 1 
 a.flipx = false
 a.flipy = false
 a.s=0
 add(actor,a)
 
 return a
end

function _init()
 -- make player top left
 --pl = make_actor(2,2)
 player = make_actor(128/2, 80,"player")
 player.spr = 0
 player.dy = 0


end

function move_actor(a)

 -- only move actor along x
 -- if the resulting position
 -- will not overlap with a wall

 
  a.x += a.dx
  
 

 -- ditto for y
  a.y += a.dy
 
 

 
end

function player_animation_control()
 anim_speed = 0.2
 --sprite_frames = 2
 the_player = get_player()
 if time()-player_walking_anim_time_gap>anim_speed then
	 the_player.spr+=2
	 player_walking_anim_time_gap=time()

	 if the_player.spr>2 then the_player.spr=0 end
 end
end

function control_player()
 the_player = get_player()
 player_moving_speed = 1  
 if (btn(1)) then 
   the_player.x += player_moving_speed
   the_player.flipx=false
   player_animation_control()
 end
 if (btn(0)) then 
   the_player.x -= player_moving_speed
   the_player.flipx=true
   player_animation_control()
 end
end

function _update60()

 if scene =="start" then
		update_menu()
	elseif scene =="game" then
		gameplay_update()
	end


end

function update_menu()
	if btnp(❎) then
		scene ="game"
	end
end

function gameplay_update()




 control_player()
 
 t = time()

    if t % 0.5 == 0 and rnd(1) < 0.5 then
        make_actor(rnd(118)+5,0,"seed")
       -- make_actor(128/2,0)
    end



 foreach(actor, move_actor)
 --only detect the seeds for removing instead of the player

 foreach(actor, remove_actor)
 


end

function remove_actor(a)
    

    if a.name~="player" then

        if a.y > 128 then
            del(actor, a)
        end

        if is_collide(a,get_player()) and get_player()~=nil then
          del(actor, a)
            
        end
    end
    



   
end

function get_player()
 -- find the player based on the object name
 for a in all(actor) do
    if a.name == "player" then
     return a
    end
 end

end


function is_collide(a, b)

    local hit = false
    
    

    if(a~=nil and b~=nil) then
        local xs = a.w*0.5+b.w*0.5
        local ys = a.h*0.5+b.h*0.5

        local xd = abs((a.x + 0.5*a.w) - (b.x + 0.5 * b.w))
        local yd = abs((a.y + 0.5*a.h) - (b.y + 0.5 * b.h))

        
        if xd<xs and yd<ys then
         hit = true        
        end
    end
    return hit
end

function draw_actor(a)

    if (a.name=="seed") then
      local sx = (a.x)
      local sy = (a.y)
      --this will need to be fixed when have time
      a.spr=sprites_list[flr(rnd(5)+1)]
      spr(a.spr, sx, sy)
    end

    if (a.name=="player") then
      --spr(0, get_player().x, get_player().y,2,2)
      --a.spr=0
      a.w=16 --will be passed to collision detect
      a.h=16 --same as above
      spr(a.spr, get_player().x, get_player().y,2,2,a.flipx,a.flipy)
    end
end

function draw_menu()
	cls()
	map(17)
	print("press ❎ to start",30,73)
end

function _draw()
	if scene =="start" then
		draw_menu()
	elseif scene =="game" then
		gameplay_draw()
	end
end

function gameplay_draw()
 cls()
 map()
-- map(0,0,0,0,16,16)
    foreach(actor,draw_actor)
 
 if(actor~=nil) then
    --print("actor numbers? "..#actor,0,120,7)

 end
 if(get_player~=nil) then
    --print("player pos: x "..get_player().x.."  y "..get_player().y,0,110,7)
 end
end

__gfx__
0000000000000000000000000000000000000000ccccccccccccccccccffffccccffffccccffffccccffffcccffffffc66666666000000000000000000000000
0000005550005550000000555000555000000000cccccccccccccccccfccccfccfccccfccfccccfccfccccfccccffccc66666666000000000000000000000000
0000005950005950000000595000595000000000cccccccccccccccccfccccfccfccccfccfccccfccfccccfccccffccc66666666000000000000000000000000
0000005995559950000000599555995000000000cccccccccccccccccfcccccccfccccfccfccccfccfcccccccccffccc66666666000000000000000000000000
0000055999999950000005599999995000000000cccccccccccccccccfcccccccfccccfccfffffcccfccfffccccffccc66666666000000000000000000000000
0000389999d77d950000389999d77d9500000000cccccccccccccccccfccccfccfccccfccfcffccccfccccfccccffccc66666666000000000000000000000000
0038339999d77d950038339999d77d9500000000cccccccccccccccccfccccfccfccccfccfccffcccfccccfccccffccc66666666000000000000000000000000
003999997777d775003999997777d77500000000ccccccccccccccccccffffccccffffcccfcccffcccffffcccffffffc66666666000000000000000000000000
0599999777777775059999977777777500000000cccccccccccccccccccccccc6dddddddddddddd6cffffffccccffcccccffffcc000000000000000000000000
5999999777777775599999977777777500000000ccccccccccccccccccccccccddddddddddddddddcccffcccccfccfcccfccccfc000000000000000000000000
5999999977777790599999997777779000000000cc77777777777777777777ccd77777777777777dcccffccccfccccfccfcccccc000000000000000000000000
5999999997777790599999999777779000000000c7767777777777777777777cdd777777777777ddcccffccccfccccfccfcccccc000000000000000000000000
5999999997777790599999999777779000000000776777777777777777777777dd777777777777ddcccffccccffffffccfcccccc000000000000000000000000
5995595597555790595599555755579000000000776677777777777777777777dd777777677777ddcccffccccfccccfccfcccccc000000000000000000000000
0555050055505550555055005500550000000000c7776666666666666666777cdd777777777777ddcccffccccfccccfccfccccfc000000000000000000000000
0000000000000000000000000000000000000000cc77777777777777777777ccdd777777777777ddcccffccccfccccfcccffffcc000000000000000000000000
0000077000070000aaaaaaaa6666666666666666cccccccc77777777dddddddddd777777777777ddcfccccfccffffffccccccccc000000000000000000000000
0000077700077070aaaaaaaa6676676666677666cccccccc77777777dddddddddd777767777777ddcfccccfccfcccccccccccccc000000000000000000000000
0999777700042077aaaaaaaa7777777766777776cccccccc7777777777777777dd777777777677ddccfccfcccfcccccccccccccc000000000000000000000000
9999997000244270aaaaaaaa6777777677777777cccccccc7777677777777777dd777777777777ddccfccfcccfcccccccccccccc000000000000000000000000
9999994002444240aaaaaaaa7766677777777777cccccccc7777777777777777dd777777777777ddccfccfcccfffffcccccccccc000000000000000000000000
9499994004244440aaaaaaaa7777777777777777cccccccc7767777777776777d77777777777777dcccffccccfcccccccccccccc000000000000000000000000
4999944044242440aaaaaaaa7677777677777777ccccccccdddddddd77777777ddddddddddddddddcccffccccfcccccccccccccc000000000000000000000000
0444440044244200aaaaaaaa7777777777777777ccccccccdddddddd777777776dddddddddddddd6cccffccccffffffccccccccc000000000000000000000000
0999999000490909000ae00000000b0044444444333939336ffffff6dd777777777777ddcccccccccccccccccccccccccccccccc000000000000000000000000
999999999449094900ee8e00000000b04444444493333333f6ffff6fdd777767777777ddcccccccccccccccccccccccccccccccc000000000000000000000000
88888888994949990ee88ee0000008884444444433333333ff6ff6ffdd777777777777ddcccccccccccccccccccccccccccccccc000000000000000000000000
33aaaa3349494994e8ee8ee8000088884444444433333339fff66fffdd777777777677ddcccccccccccccccccccccccccccccccc000000000000000000000000
444aa44409999990ee8ee8ee0008e8824444444493333333fff66fffdd777777777777ddcccccccccccccccccccccccccccccccc000000000000000000000000
444444446777777688888888000e88824444444433333333ff6ff6ffdd777777777777ddcccccccccccccccccccccccccccccccc000000000000000000000000
99999999d777777d0797979008888820444444443333333af6ffff6fdd776777777777ddcccccccccccccccccccccccccccccccc000000000000000000000000
09999990577777750f9f9f900022220044444444636933336ffffff6dd777777777777ddcccccccccccccccccccccccccccccccc000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6666ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6666ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
6666ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
__gff__
0002020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c2525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
363636363636363636363636363636363625252525252525252525253c3c2525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
363636363636363636363636363636363625253c0708090a0b06063c3c252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525250606060606060606250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
36363636363636363636363636363636362525252525251a1b1c082a2b092525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363636252525252525252525252525252525250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1414141414141414141414141414141414141400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
01100000005003200000000000000050000000000003200000500000003100000000005002a00000000000000050029000000002b0000050000000210002a000005002a000000000000000500000002900000000
011800000c043185201c5201f5203c6151f020210201c0200c04318020280202b0203c5351b0201a020180200c04324020280202b0203c6151f020210201c0200c04324020280202b0203c535332103222030220
011800002b552297422873224542245502404024531285412b552297422873224540245502404228532245422b552297422873224540245502404128531245422b55229742287322454024550240412652124522
011800000042504335072450c4550032504235074450c3550023504445073550c265321230c0002f0141b1110033504245074550c3650023504445073550c2650043504345072550c465331210c0002f0111b111
011800000c02510535130250c5351802510535130250c5350c0251c5351302527711177111c71120711197110c025105351f0250c5350c0251053513025185350c025105351302527711177111c7112071119711
0118000024325283252b325303262b3252d32528325263001c326283252b325303252722526225242252630024325283262b325303252b3252d326283252630024325282252b2263022533327324253021030215
011800001024513355184650c2351034513400182000c3001034513335243652674524544245441b100000001024513355184650c2351034513400182000c3001034513335243652674524544245441b10000000
0118000004125040350412504035041250403504125040351c1151c12534115281251c1151071110711107111c1151c125281151c1251c7211072110721107211c1151c125341152612528111281111c7111c711
011800001f5520042504335072450c4550032504235074450c3550023504445073550c265321230c0002f0141b1110033504245074550c3650023504445073550c2650043504345072550c465331210c0002f011
011800002400028552241422853226122000002b02226032000002b04600000297522874200000260320000024022000002803226042000002b7552674228000285322912226532290002900024547245551a000
0118000004125040320c0251c532130260c5321802510535130250c5330c0251c5351302400000000000000018025105351f0250c535180251053613025185351802510533130250e535180341c7000000000000
01180000303151c525373153c526373153952534115263002841534515373153c2173331532515302151851200000302153411637315355123431532515345150000000000325153431535115327143071400000
01180000280002b0422b0322b042000002b0422d0322d04228042280322b000290422903229041280422604226032000000000024042260422803228042000002604228032290472904229032260322403124031
0118000024115282152b115302162b1152d21528115263001c216281152b215301152721526115242152630018115282162b115302152b1152d216281152630024115282152b1163021527117264152441024415
__music__
00 01030405
00 01090405
00 01060705
00 01020705
00 01030405
00 01090a0b
02 010c0a0d
00 41434444

